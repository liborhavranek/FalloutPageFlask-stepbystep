{% extends 'base.html' %}

{% block content %}

<center>
<h1>Příspěvky</h1>
<br>
{% for post in posts %}

<div class="shadow-lg p-3 mb-5 bg-body rounded w-50 post-div">
    {{ post.id }} <br>
<h5>{{ post.user.username }} <br></h5>
<hr>
    <h2><a href="/post/{{post.id}}">{{ post.title}}</a></h2> <br>
    <p>{{ post.text|safe }}</p> <br>

    {{ post.date_created }} <br>
    <hr>
    {% if user.id == post.author %}
    <a href="/edit_post/{{post.id}}" class="btn btn-secondary">Upravit</a>
    <a href="/delete_post/{{post.id}}" class="btn btn-danger">Smazat</a>
    {% endif %}
    <br><br>
    <div class="collapse" id="comments-{{post.id}}">
        <div class="card">
            <div class="card-body" id="comments-expanded-{{post.id}}">

                {% for comment in post.comments %}
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                    <a href="/posts/{{comment.user.username}}">{{comment.user.username}}</a>
                    {{comment.text}}
                </div>
                    <div>

                        <small class="text-muted">{{comment.date_created}}</small>
                    </div>
                    <div>
                        {% if user.id == comment.author or user.id == post.author %}
                        <a href="/delete_comment/{{comment.id}}">smazat</a> 
                        {% endif %}
                    </div>
                </div>

                
                {% endfor %}
            </div>
        </div>
    </div>
    <br>
<p class="card-text">
{%if post.comments|length > 0 %}
    <a data-bs-toggle="collapse" href="#comments-{{post.id}}" role="button">
    <small class="text-muted">Přečíst {{post.comments|length}}</small> komentáře</a>
{% else %}
    <small class="text-muted">Napiš první komentář</small>
{% endif %}

</p>

    <form action="/create_comment/{{post.id}}" class="input-group mb-3" method="POST">

        <input type="text" id="text" name="text" class="form-control" placeholder="okomentuj prispevek">
        <button type="submit" class="btn btn-primary">Komentář</button>
    </form>


    
</div>
{% endfor%}
</center>

{% endblock %}